<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>循環コード変換アプリ</title>
    <style>
        .bold { font-weight: bold; }
        .link-symbol { color: blue; cursor: pointer; }
        #currentProgram { height: 150px; overflow: auto; background-color: #f8f8f8; border: 1px solid #ddd; padding: 10px; }
        .results { font-size: smaller; white-space: nowrap; }
    </style>
</head>
<body>
    <h1>循環コード変換アプリ</h1>
    <input type="number" id="inputNumber" placeholder="数値を入力">
    <button onclick="calculateCodes()">計算する</button>
    <p id="result1" class="results"></p>
    <p id="result2" class="results"></p>
    <p id="result3" class="results"></p>
    <p id="result4" class="results"></p>
    <p id="result5" class="results"></p>
    <p id="result6" class="results"></p>
    <p id="result7" class="results"></p>
    <p id="result8" class="results"></p>
    <p id="resultSyncCode" class="results"></p>

    <h2>保存した定義を読み込む</h2>
    <textarea id="savedData" rows="5" placeholder="ここに定義を入力"></textarea>
    <button onclick="loadSavedData()">読み込む</button>

    <h2>同期作動コードの割り当て</h2>
    <input type="number" id="inputSyncJ" placeholder="循環コード数">
    <input type="number" id="inputSyncCode" placeholder="割り当てるコード">
    <button onclick="assignSyncCode()">割り当てる</button>
    <p id="assignedSyncCode"></p>

    <h2>URLの割り当て</h2>
    <input type="number" id="inputUrlJ" placeholder="循環コード数">
    <input type="text" id="inputUrl" placeholder="URL">
    <button onclick="assignUrl()">割り当てる</button>
    <p id="assignedUrl"></p>

    <button onclick="showCurrentProgram()">現在定義されているプログラムを表示</button>
    <pre id="currentProgram"></pre>
    <button onclick="copyToClipboard()">定義をコピーする</button>

    <script>
        var syncCodes = JSON.parse(localStorage.getItem('syncCodes')) || {};
        var urls = JSON.parse(localStorage.getItem('urls')) || {};

        function calculateCodes() {
            var n = document.getElementById('inputNumber').value;
            n = parseInt(n);
            var j = n % 360;

            var y_integrated = 360 - j;
            var y_opposite = (j + 180) % 360;
            var y_secret = 540 - j > 360 ? 540 - j - 360 : 540 - j;
            var y_honest_angle = j + 90 > 360 ? j + 90 - 360 : j + 90;
            var y_honest_secret = 540 - y_honest_angle > 360 ? 540 - y_honest_angle - 360 : 540 - y_honest_angle;
            var y_negative_angle = j - 90 < 0 ? j - 90 + 360 : j - 90;
            var y_negative_secret = 540 - y_negative_angle > 360 ? 540 - y_negative_angle - 360 : 540 - y_negative_angle;

            document.getElementById('result1').innerHTML = '<span class="bold">中心コード: </span>' + formatLink(j);
            document.getElementById('result2').innerHTML = '<span class="bold">統合コード: </span>' + formatLink(y_integrated);
            document.getElementById('result3').innerHTML = '<span class="bold">対抗コード: </span>' + formatLink(y_opposite);
            document.getElementById('result4').innerHTML = '<span class="bold">機密コード: </span>' + formatLink(y_secret);
            document.getElementById('result5').innerHTML = '<span class="bold">正直コード: </span>' + formatLink(y_honest_angle);
            document.getElementById('result6').innerHTML = '<span class="bold">正機コード: </span>' + formatLink(y_honest_secret);
            document.getElementById('result7').innerHTML = '<span class="bold">負直コード: </span>' + formatLink(y_negative_angle);
            document.getElementById('result8').innerHTML = '<span class="bold">負機コード: </span>' + formatLink(y_negative_secret);

            displaySyncCodes(j);
        }

        function displaySyncCodes(j) {
            if (syncCodes[j]) {
                var syncCodesForJ = syncCodes[j].slice();
                syncCodesForJ.sort((a, b) => parseInt(a) - parseInt(b));
                document.getElementById('resultSyncCode').innerHTML = '<span class="bold">同期作動コード: </span>' + syncCodesForJ.map(formatLink).join(', ');
            } else {
                document.getElementById('resultSyncCode').innerHTML = '<span class="bold">同期作動コード: </span>なし';
            }
        }

        function assignSyncCode() {
            var jValue = parseInt(document.getElementById('inputSyncJ').value);
            var syncCodeValue = parseInt(document.getElementById('inputSyncCode').value);

            if (!syncCodes[jValue]) {
                syncCodes[jValue] = [];
            }
            if (!syncCodes[syncCodeValue]) {
                syncCodes[syncCodeValue] = [];
            }

            if (!syncCodes[jValue].includes(syncCodeValue)) {
                syncCodes[jValue].push(syncCodeValue);
            }
            if (!syncCodes[syncCodeValue].includes(jValue)) {
                syncCodes[syncCodeValue].push(jValue);
            }

            localStorage.setItem('syncCodes', JSON.stringify(syncCodes));
            document.getElementById('assignedSyncCode').textContent = '同期作動コード ' + jValue + ' に ' + syncCodeValue + ' を追加し、' + syncCodeValue + ' に ' + jValue + ' も追加しました。';
        }

        function assignUrl() {
            var jValue = parseInt(document.getElementById('inputUrlJ').value);
            var urlValue = document.getElementById('inputUrl').value;
            urls[jValue] = urlValue;
            localStorage.setItem('urls', JSON.stringify(urls));
            document.getElementById('assignedUrl').textContent = '循環コード数 ' + jValue + ' にURL ' + urlValue + ' を割り当てました。';
        }

        function formatLink(value) {
            return urls[value] ? '<a href="' + urls[value] + '" target="_blank" class="link-symbol">' + value + '</a>' : value;
        }

        function loadSavedData() {
            var savedData = document.getElementById('savedData').value;
            try {
                var data = JSON.parse(savedData);
                if (data.syncCodes) syncCodes = data.syncCodes;
                if (data.urls) urls = data.urls;
                localStorage.setItem('syncCodes', JSON.stringify(syncCodes));
                localStorage.setItem('urls', JSON.stringify(urls));
                alert('データが読み込まれました。');
            } catch(e) {
                alert('読み込みに失敗しました: ' + e);
            }
        }

        function showCurrentProgram() {
            document.getElementById('currentProgram').textContent = JSON.stringify({ syncCodes: syncCodes, urls: urls }, null, 2);
        }

        function copyToClipboard() {
            var content = document.getElementById('currentProgram').textContent;
            navigator.clipboard.writeText(content)
                .then(() => alert('コピーしました!'))
                .catch(err => alert('コピーに失敗しました: ' + err));
        }
    </script>
</body>
</html>
