<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>循環コード変換アプリ</title>
    <style>
        .bold { font-weight: bold; }
        .link-symbol { color: blue; cursor: pointer; }
        #currentProgram { height: 150px; overflow: auto; background-color: #f8f8f8; border: 1px solid #ddd; padding: 10px; }
        .results { font-size: smaller; white-space: nowrap; }
    </style>
</head>
<body>
    <h1>循環コード変換アプリ</h1>
    <h2 id="dailyCodeTitle">N年X月Y日の日運コード</h2>
    <input type="date" id="inputDate" onchange="updateDailyCodeTitle()">
    <input type="number" id="inputNumber" placeholder="数値を入力">
    <button onclick="calculateCodes()">計算する</button>
    <p id="result1" class="results"></p>
    <p id="result2" class="results"></p>
    <p id="result3" class="results"></p>
    <p id="result4" class="results"></p>
    <p id="result5" class="results"></p>
    <p id="result6" class="results"></p>
    <p id="result7" class="results"></p>
    <p id="result8" class="results"></p>
    <p id="resultSyncCode" class="results"></p>
    <p id="dailyCode" class="results"></p>

    <h2>保存した定義を読み込む</h2>
    <textarea id="savedData" rows="5" placeholder="ここに定義を入力"></textarea>
    <button onclick="loadSavedData()">読み込む</button>

    <h2>同期作動コードの割り当て</h2>
    <input type="number" id="inputSyncJ" placeholder="循環コード数">
    <input type="number" id="inputSyncCode" placeholder="割り当てるコード">
    <button onclick="assignSyncCode()">割り当てる</button>
    <p id="assignedSyncCode"></p>

    <h2>URLの割り当て</h2>
    <input type="number" id="inputUrlJ" placeholder="循環コード数">
    <input type="text" id="inputUrl" placeholder="URL">
    <button onclick="assignUrl()">割り当てる</button>
    <p id="assignedUrl"></p>

    <button onclick="showCurrentProgram()">現在定義されているプログラムを表示</button>
    <pre id="currentProgram"></pre>
    <button onclick="copyToClipboard()">定義をコピーする</button>

    <script>
        var syncCodes = JSON.parse(localStorage.getItem('syncCodes')) || {};
        var urls = JSON.parse(localStorage.getItem('urls')) || {};

        // 初期日付を設定
        document.getElementById('inputDate').valueAsDate = new Date();

        function updateDailyCodeTitle() {
            var inputDate = document.getElementById('inputDate').value;
            var dateParts = inputDate.split('-');
            var year = parseInt(dateParts[0]);
            var month = parseInt(dateParts[1]);
            var day = parseInt(dateParts[2]);

            var baseNumber = calculateBaseNumber(year);
            var monthBaseNumber = baseNumber + month - 1;
            monthBaseNumber = convertToCycleCode(monthBaseNumber);

            var dailyCode = calculateDailyCode(year, month, day, baseNumber, monthBaseNumber);
            document.getElementById('dailyCodeTitle').textContent = year + '年' + month + '月' + day + '日の日運コード';
            document.getElementById('dailyCode').innerHTML = '<span class="bold">数日日運: </span>' + dailyCode.join('<br>');
        }

        function calculateBaseNumber(year) {
            var baseNumber = year - 2000 + 60;
            return convertToCycleCode(baseNumber);
        }

        function calculateDailyCode(year, month, day, baseNumber, monthBaseNumber) {
            var dailyCode = [];
            dailyCode.push(calculateMonthSpecificValue(month, day));
            var dayValue = day - 1;
            dailyCode.push(convertToCycleCode(monthBaseNumber + dayValue));
            dailyCode.push(convertToCycleCode(monthBaseNumber + 1 + dayValue));
            dailyCode.push(convertToCycleCode(monthBaseNumber + dayValue + 60));
            dailyCode.push(convertToCycleCode(monthBaseNumber + 1 + dayValue + 60));
            dailyCode.push(convertToCycleCode(monthBaseNumber + dayValue + 72));
            dailyCode.push(convertToCycleCode(monthBaseNumber + 1 + dayValue + 72));
            return dailyCode;
        }

        function calculateMonthSpecificValue(month, day) {
            var value;
            switch (month) {
                case 1: value = [11 + day - 1, 11 + 90 + day - 1]; break;
                case 2: value = [21 + day - 1, 21 + 180 + day - 1]; break;
                // ...他の月の計算...
                case 12: value = [81 + day - 1]; break;
                default: value = [0];
            }
            return value.map(convertToCycleCode).join(' / ');
        }

        function convertToCycleCode(value) {
            while (value < 1) value += 360;
            while (value > 360) value -= 360;
            return value;
        }

        function calculateCodes() {
            var n = document.getElementById('inputNumber').value;
            n = parseInt(n);
            var j = n % 360;

            var y_integrated = 360 - j;
            var y_opposite = (j + 180) % 360;
            var y_secret = 540 - j > 360 ? 540 - j - 360 : 540 - j;
            var y_honest_angle = j + 90 > 360 ? j + 90 - 360 : j + 90;
            var y_honest_secret = 540 - y_honest_angle > 360 ? 540 - y_honest_angle - 360 : 540 - y_honest_angle;
            var y_negative_angle = j - 90 < 0 ? j - 90 + 360 : j - 90;
            var y_negative_secret = 540 - y_negative_angle > 360 ? 540 - y_negative_angle - 360 : 540 - y_negative_angle;

            document.getElementById('result1').innerHTML = '<span class="bold">中心コード: </span>' + formatLink(j);
            document.getElementById('result2').innerHTML = '<span class="bold">統合コード: </span>' + formatLink(y_integrated);
            document.getElementById('result3').innerHTML = '<span class="bold">対抗コード: </span>' + formatLink(y_opposite);
            document.getElementById('result4').innerHTML = '<span class="bold">機密コード: </span>' + formatLink(y_secret);
            document.getElementById('result5').innerHTML = '<span class="bold">正直コード: </span>' + formatLink(y_honest_angle);
            document.getElementById('result6').innerHTML = '<span class="bold">正機コード: </span>' + formatLink(y_honest_secret);
            document.getElementById('result7').innerHTML = '<span class="bold">負直コード: </span>' + formatLink(y_negative_angle);
            document.getElementById('result8').innerHTML = '<span class="bold">負機コード: </span>' + formatLink(y_negative_secret);

            displaySyncCodes(j);
        }

        // ...他の関数（assignSyncCode, assignUrl, loadSavedData, showCurrentProgram, copyToClipboard）...

        function formatLink(value) {
            return urls[value] ? '<a href="' + urls[value] + '" target="_blank" class="link-symbol">' + value + '</a>' : value;
        }
    </script>
</body>
</html>

